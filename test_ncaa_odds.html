<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NCAA Game Predictions</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f7f6;
}
h2 {
    color: #d32f2f;
    text-align: center;
    margin-top: 20px;
    margin-bottom: 20px;
}
table {
    width: 90%;
    margin: 20px auto;
    border-collapse: collapse;
}
th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center; /* Center align text */
}
th {
    background-color: #d32f2f;
    color: white;
}
tr:nth-child(even) {
    background-color: #E1E0E0; /* Lightly shade every other row */
}
.progress-bar-container {
    background-color: #e0e0e0;
    border-radius: 2px;
    width: 100%;
    height: 20px;
}
.progress-bar {
    background-color: #4caf50;
    height: 100%;
    border-radius: 2px;
}
</style>
</head>
<body>
<nav>
    <div class="navLinks">
        <a href="home.html">My Faculty Website</a>
    </div>
</nav>
<h2>Kemper's NCAA Game Predictions</h2>

<div style="text-align: center; margin-bottom: 20px;">
    <label for="dateFilter">Select a Date:</label>
    <select id="dateFilter">
        <option value="">All Dates</option>
    </select>
</div>

<table id="predictionsTable">
    <thead>
        <tr>
            <th>Games</th>
            <th>Conference</th>
            <th>Win Probability</th>
            <th>The Model Predicts</th>
        </tr>
    </thead>
    <tbody>
        <!-- Table rows will be dynamically generated here -->
    </tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const csvUrl = 'https://raw.githubusercontent.com/jameskemper/wreckem_model/main/Data/Predictions/predictions.csv';
    const dateFilter = document.getElementById('dateFilter');
    const tableBody = document.getElementById('predictionsTable').getElementsByTagName('tbody')[0];
    const uniqueDates = new Set();

    Papa.parse(csvUrl, {
        download: true,
        header: true,
        complete: function(results) {
            results.data.forEach(function(row) {
                if (row.date && row.team && row.oppteam && row.percentage_sim_win) {
                    uniqueDates.add(row.date); // Collect unique dates

                    const tr = document.createElement('tr');
                    tr.setAttribute('data-date', row.date); // Set data attribute for filtering
                    let winProb = parseFloat(row.percentage_sim_win) * 100;
                    winProb = winProb >= 100 ? 99.9 : winProb.toFixed(1);
                    const progressBarWidth = `${winProb}%`;
                    tr.innerHTML = `<td>${row.team} vs ${row.oppteam}</td>
                                    <td>${row.teamconf}</td>
                                    <td>
                                        <div class="progress-bar-container">
                                            <div class="progress-bar" style="width: ${progressBarWidth};"></div>
                                        </div>
                                        ${winProb}%
                                    </td>
                                    <td>${row.message}</td>`;
                    tableBody.appendChild(tr);
                }
            });

            // Populate date dropdown
            uniqueDates.forEach(date => {
                const option = new Option(date, date);
                dateFilter.add(option);
            });
        },
        error: function(err) {
            console.error("Error loading CSV:", err);
        }
    });

    // Filter table rows based on selected date
    dateFilter.addEventListener('change', function() {
        const selectedDate = this.value;
        const rows = tableBody.querySelectorAll('tr');
        rows.forEach(row => {
            if (selectedDate === "" || row.getAttribute('data-date') === selectedDate) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    });
});
</script>
</body>
</html>
