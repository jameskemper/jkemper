<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NCAA Game Predictions</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f7f6;
}
h2 {
    color: #d32f2f;
    text-align: center;
    margin-top: 20px;
    margin-bottom: 20px;
}
table {
    width: 90%;
    margin: 20px auto;
    border-collapse: collapse;
}
th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}
th {
    background-color: #d32f2f;
    color: white;
}
tr:nth-child(even) {
    background-color: #E1E0E0;
}
.progress-bar-container {
    background-color: #DAD0FF;
    border-radius: 2px;
    width: 100%;
    height: 20px;
}
.progress-bar {
    background-color: #2D04B9;
    height: 100%;
    border-radius: 2px;
}
.filter-container {
    text-align: center; 
    margin-bottom: 20px;
}
img.team-logo {
    height: 50px;
    width: 50px;
    object-fit: contain;
    margin: 0 auto;
    display: block;
}
.team-matchup {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    height: 120px;
}
.vs-text {
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
}
</style>
</head>
<body>
<nav>
    <a href="https://www.myweb.ttu.edu/jkemper/about_NCAA_odds.html" class="active">About the Model</a>
</nav>
<h2>Kemper's NCAA Game Predictions</h2>

<div class="filter-container">
    <label for="dateFilter">Select a Date:</label>
    <select id="dateFilter">
        <option value="">All Dates</option>
    </select>
    <label for="teamFilter">Select a Team:</label>
    <select id="teamFilter">
        <option value="">All Teams</option>
    </select>
    <label for="conferenceFilter">Select a Conference:</label>
    <select id="conferenceFilter">
        <option value="">All Conferences</option>
    </select>
</div>

<table id="predictionsTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Teams</th>
            <th>Conference</th>
            <th>Predicted Winner</th>
            <th>Win Probability</th>
        </tr>
    </thead>
    <tbody>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const csvUrl = 'https://raw.githubusercontent.com/jameskemper/wreckem_model/main/Data/Predictions/predictions.csv';
    const dateFilter = document.getElementById('dateFilter');
    const teamFilter = document.getElementById('teamFilter');
    const conferenceFilter = document.getElementById('conferenceFilter');
    const tableBody = document.getElementById('predictionsTable').getElementsByTagName('tbody')[0];
    const uniqueDates = new Set();
    const uniqueTeams = new Set();
    const uniqueConferences = new Set();
    const logoBaseURL = 'https://raw.githubusercontent.com/jameskemper/wreckem_model/main/NCAA_logos/';

    function convertTeamNameForURL(name) {
        return name.toLowerCase().replace(/\bst\.$/, "state").replace("a&m", "am").replace(/-/g, '').replace(/\s+/g, '').replace("'", "");
    }

    Papa.parse(csvUrl, {
        download: true,
        header: true,
        complete: function(results) {
            results.data.forEach(function(row) {
                if (row.date && row.team && row.oppteam && row.winner && row.teamconf) {
                    uniqueDates.add(row.date);
                    uniqueTeams.add(row.team);
                    uniqueTeams.add(row.oppteam);
                    uniqueConferences.add(row.teamconf);

                    const teamLogoURL = `${logoBaseURL}${convertTeamNameForURL(row.team)}.png`;
                    const oppTeamLogoURL = `${logoBaseURL}${convertTeamNameForURL(row.oppteam)}.png`;
                    const winProb = parseFloat(row.percentage_sim_win) * 100;
                    const progressBarWidth = `${winProb}%`;

                    const tr = document.createElement('tr');
                    tr.setAttribute('data-date', row.date);
                    tr.setAttribute('data-team', row.team);
                    tr.setAttribute('data-conference', row.teamconf);
                    tr.innerHTML = `<td>${row.date}</td>
                                    <td>
                                        <div class="team-matchup">
                                            <img src="${teamLogoURL}" alt="${row.team}" class="team-logo">
                                            <div class="vs-text">vs</div>
                                            <img src="${oppTeamLogoURL}" alt="${row.oppteam}" class="team-logo">
                                        </div>
                                    </td>
                                    <td>${row.teamconf}</td>
                                    <td>${row.winner}</td>
                                    <td>
                                        <div class="progress-bar-container">
                                            <div class="progress-bar" style="width: ${progressBarWidth};"></div>
                                        </div>
                                        ${winProb.toFixed(1)}%
                                    </td>`;
                    tableBody.appendChild(tr);
                }
            });

            uniqueDates.forEach(date => {
                const option = document.createElement("option");
                option.value = date;
                option.text = date;
                dateFilter.appendChild(option);
            });

            uniqueTeams.forEach(team => {
                const option = document.createElement("option");
                option.value = team;
                option.text = team;
                teamFilter.appendChild(option);
            });

            uniqueConferences.forEach(conference => {
                const option = document.createElement("option");
                option.value = conference;
                option.text = conference;
                conferenceFilter.appendChild(option);
            });
        }
    });

    function filterTable() {
        const selectedDate = dateFilter.value;
        const selectedTeam = teamFilter.value;
        const selectedConference = conferenceFilter.value;
        const rows = tableBody.querySelectorAll('tr');
        rows.forEach(row => {
            const isDateMatch = selectedDate === "" || row.getAttribute('data-date') === selectedDate;
            const isTeamMatch = selectedTeam === "" || row.getAttribute('data-team') === selectedTeam || row.cells[1].textContent.includes(selectedTeam);
            const isConferenceMatch = selectedConference === "" || row.getAttribute('data-conference') === selectedConference;
            row.style.display = (isDateMatch && isTeamMatch && isConferenceMatch) ? "" : "none";
        });
    }

    dateFilter.addEventListener('change', filterTable);
    teamFilter.addEventListener('change', filterTable);
    conferenceFilter.addEventListener('change', filterTable);
});
</script>
</body>
</html>